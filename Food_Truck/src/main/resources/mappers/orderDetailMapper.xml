<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.foodtruck.dao.OrderDetailDAO">

	<!-- 주문 상세 정보 -->
	<select id="getOrderDetail" resultMap="OrderDetailMap">

		SELECT * FROM ORDERDETAIL
		<where> ORDER_NO=#{ordNo} </where>

	</select>

	<!-- 주문 상세 리스트 -->
	<select id="getOrderDetailList" resultMap="OrderDetailMap">

		<!-- SELECT O.PROD_NO,O.ORDER_NO,P.PROD_NAME,O.QTY,O.ORD_PRICE -->
		<!-- FROM ORDERDETAIL O,PRODUCT P -->
		<!-- <where> -->
		<!-- O.PROD_NO = P.PROD_NO AND P.LICENSE_NO IN (SELECT L.LICENSE_NO FROM -->
		<!-- LICENSE L -->
		<!-- </where> -->
		<!-- <where> L.SEL_ID = #{selId})</where> -->

	
		SELECT O.PROD_NO, O.ORD_NO, P.PROD_NAME, O.ORD_QTY, O.ORD_PRICE
		FROM ORDERDETAIL O, PRODUCT P, ORDERS
		<where>
			O.ORD_NO = ORDERS.ORD_NO
			AND P.PROD_NO = O.PROD_NO
			AND ORDERS.LICENSE_NO IN (SELECT L.LICENSE_NO FROM LICENSE L WHERE L.MEM_ID=#{memId})
		</where>

	</select>

	<!-- 주문 등록  -->
	<insert id="insertOrderDetail" parameterType="map">
		
		INSERT INTO ORDERDETAIL (ORD_NO, PROD_NO, ORD_QTY, ORD_PRICE)
		VALUES (#{ordNo}, #{prodNo}, #{ordQty}, (#{ordPrice} * #{ordQty}))
	
	</insert>
	
	<!-- 주문한 목록(영수증 역할)  -->
	<select id="getOrderInfoList" resultMap="OrderDetailMap">
		
		SELECT D.*, O.*, P.*
		FROM ORDERDETAIL D
		INNER JOIN ORDERS O
		ON D.ORD_NO = O.ORD_NO
		AND D.ORD_NO=#{ordNo}
		INNER JOIN PRODUCT P
		ON D.PROD_NO = P.PROD_NO
	
	</select>


	<!-- OrderDetailVO -->
	<resultMap type="OrderDetailVO" id="OrderDetailMap" extends="OrderMap">
		<result column="PROD_NO" property="prodNo" />
		<result column="ORD_NO" property="ordNo" />
		<result column="PROD_NAME" property="prodName" />
		<result column="ORD_REQ" property="ordReq"/>
		<result column="ORD_QTY" property="ordQty" />
		<result column="ORD_PRICE" property="ordPrice" />
		<result column="MEM_ID" property="memId" />
	</resultMap>
	
	<resultMap type="OrderVO" id="OrderMap">
		<result column="ORD_NO" property="ordNo"/>
		<result column="ORD_NAME" property="ordName"/>
		<result column="ORD_TEL" property="ordTel"/>
		<result column="ORD_REQ" property="ordReq"/>
		<result column="ORD_DATE" property="ordDate"/>
		<result column="ORD_RSV_DATE" property="ordRsvDate"/>
		<result column="ORD_DLV_YN" property="ordDlyYn"/>
		<result column="ORD_STAT" property="ordStat"/>
		<result column="COOK_STAT" property="cookStat"/>
		<result column="MEM_ID" property="memId"/>
		<result column="LICENSE_NO" property="licenseNo"/>
		<result column="SUM_PRICE" property="sumPrice"/>
	</resultMap>
</mapper>